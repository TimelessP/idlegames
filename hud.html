<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>NATO Fighter Jet HUD Display</title>
    <style>
        /* NATO HUD Standards - Based on STANAG specifications */
        :root {
            --hud-green: #00ff41;
            --hud-amber: #ffbf00;
            --hud-red: #ff0000;
            --hud-white: #ffffff;
            --hud-background: rgba(0, 0, 0, 0.85);
            
            /* NATO standard font sizing */
            --hud-font-xs: 10px;
            --hud-font-sm: 12px;
            --hud-font-md: 14px;
            --hud-font-lg: 16px;
            --hud-font-xl: 20px;
            --hud-font-xxl: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace; /* NATO standard monospace */
            background: #000;
            color: var(--hud-green);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .hud-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: var(--hud-background);
            display: flex;
            flex-direction: column;
        }

        /* NATO HUD Layout - Primary Flight Reference */
        .attitude-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border: 2px solid var(--hud-green);
            border-radius: 50%;
            overflow: hidden;
        }

        .horizon-line {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--hud-green);
            transform-origin: center;
            transition: transform 0.1s ease;
        }

        .aircraft-symbol {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            z-index: 10;
        }

        .aircraft-symbol::before,
        .aircraft-symbol::after {
            content: '';
            position: absolute;
            background: var(--hud-amber);
        }

        .aircraft-symbol::before {
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            transform: translateY(-50%);
        }

        .aircraft-symbol::after {
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            transform: translateX(-50%);
        }

        /* NATO Standard Flight Path Vector (FPV) */
        .flight-path-vector {
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid var(--hud-green);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.1s ease;
        }

        .flight-path-vector::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 50%;
            width: 2px;
            height: 8px;
            background: var(--hud-green);
            transform: translateX(-50%);
        }

        .flight-path-vector::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            width: 6px;
            height: 2px;
            background: var(--hud-green);
            transform: translateX(-50%);
        }

        /* NATO HUD Pitch Ladder */
        .pitch-ladder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 300px;
            pointer-events: none;
        }

        .pitch-line {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            color: var(--hud-green);
            font-size: var(--hud-font-sm);
            white-space: nowrap;
        }

        /* NATO Standard Airspeed and Altitude Tapes */
        .left-tape, .right-tape {
            position: absolute;
            top: 20%;
            width: 60px;
            height: 60%;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--hud-green);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: var(--hud-font-md);
        }

        .left-tape {
            left: 20px;
        }

        .right-tape {
            right: 20px;
        }

        .tape-value {
            font-size: var(--hud-font-lg);
            font-weight: bold;
            color: var(--hud-green);
            text-align: center;
            padding: 5px;
            border: 1px solid var(--hud-green);
            background: rgba(0, 0, 0, 0.8);
            margin: 2px 0;
        }

        .tape-label {
            font-size: var(--hud-font-xs);
            color: var(--hud-green);
            text-align: center;
        }

        /* NATO Standard Heading Tape */
        .heading-tape {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 40px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--hud-green);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--hud-font-md);
            overflow: hidden;
        }

        .heading-value {
            font-size: var(--hud-font-lg);
            font-weight: bold;
            color: var(--hud-green);
            text-align: center;
            min-width: 50px;
        }

        .heading-indicator {
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 10px solid var(--hud-green);
        }

        /* NATO Standard System Status */
        .status-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            height: 80px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--hud-green);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            padding: 10px;
            font-size: var(--hud-font-sm);
        }

        .status-item {
            text-align: center;
            color: var(--hud-green);
        }

        .status-value {
            font-size: var(--hud-font-md);
            font-weight: bold;
            display: block;
            margin-bottom: 2px;
        }

        .status-label {
            font-size: var(--hud-font-xs);
            opacity: 0.8;
        }

        /* NATO Standard Warning System */
        .warning-panel {
            position: absolute;
            top: 80px;
            left: 20px;
            max-width: 200px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid var(--hud-red);
            padding: 10px;
            color: var(--hud-red);
            font-size: var(--hud-font-sm);
            display: none;
        }

        .warning-panel.active {
            display: block;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        /* NATO Standard Navigation Display */
        .nav-info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--hud-green);
            padding: 10px;
            font-size: var(--hud-font-sm);
            min-width: 120px;
        }

        .nav-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            color: var(--hud-green);
        }

        /* G-Force Indicator */
        .g-force-indicator {
            position: absolute;
            top: 50%;
            right: 80px;
            transform: translateY(-50%);
            width: 20px;
            height: 100px;
            border: 1px solid var(--hud-green);
            background: rgba(0, 0, 0, 0.7);
        }

        .g-force-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--hud-green);
            transition: height 0.1s ease;
        }

        /* Calibration Controls */
        .calibration-panel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid var(--hud-amber);
            padding: 20px;
            color: var(--hud-amber);
            font-size: var(--hud-font-md);
            text-align: center;
            z-index: 1000;
        }

        .calibration-panel.hidden {
            display: none;
        }

        .calibration-button {
            background: transparent;
            border: 1px solid var(--hud-amber);
            color: var(--hud-amber);
            padding: 10px 20px;
            margin: 5px;
            font-family: inherit;
            font-size: var(--hud-font-sm);
            cursor: pointer;
        }

        .calibration-button:hover {
            background: var(--hud-amber);
            color: #000;
        }

        /* Responsive Design for Mobile */
        @media (max-width: 768px) {
            .attitude-indicator {
                width: 150px;
                height: 150px;
            }
            
            .left-tape, .right-tape {
                width: 50px;
                top: 25%;
                height: 50%;
            }
            
            .heading-tape {
                width: 250px;
            }
            
            .status-panel {
                grid-template-columns: repeat(3, 1fr);
                height: 70px;
            }
            
            .nav-info {
                font-size: var(--hud-font-xs);
                min-width: 100px;
            }
        }

        @media (max-width: 480px) {
            .attitude-indicator {
                width: 120px;
                height: 120px;
            }
            
            .heading-tape {
                width: 200px;
            }
            
            .status-panel {
                grid-template-columns: repeat(2, 1fr);
                font-size: var(--hud-font-xs);
            }
        }

        /* Permission Request Overlay */
        .permission-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            color: var(--hud-green);
            text-align: center;
            padding: 20px;
        }

        .permission-overlay.hidden {
            display: none;
        }

        .permission-button {
            background: transparent;
            border: 2px solid var(--hud-green);
            color: var(--hud-green);
            padding: 15px 30px;
            margin: 10px;
            font-family: inherit;
            font-size: var(--hud-font-md);
            cursor: pointer;
            text-transform: uppercase;
        }

        .permission-button:hover {
            background: var(--hud-green);
            color: #000;
        }
    </style>
</head>
<body>
    <!-- Permission Request Overlay -->
    <div class="permission-overlay" id="permissionOverlay">
        <h1 style="font-size: var(--hud-font-xxl); margin-bottom: 20px;">NATO FIGHTER JET HUD</h1>
        <p style="font-size: var(--hud-font-md); margin-bottom: 30px; max-width: 400px;">
            This HUD requires access to device sensors and location for accurate flight data.
            All data processing follows NATO STANAG specifications.
        </p>
        <button class="permission-button" id="enableHUD">ENABLE HUD SYSTEMS</button>
        <p style="font-size: var(--hud-font-sm); margin-top: 20px; opacity: 0.7;">
            Requires HTTPS for sensor access
        </p>
    </div>

    <!-- Main HUD Container -->
    <div class="hud-container" id="hudContainer" style="display: none;">
        <!-- Attitude Indicator -->
        <div class="attitude-indicator" id="attitudeIndicator">
            <div class="horizon-line" id="horizonLine"></div>
            <div class="aircraft-symbol"></div>
        </div>

        <!-- Flight Path Vector -->
        <div class="flight-path-vector" id="flightPathVector"></div>

        <!-- Pitch Ladder -->
        <div class="pitch-ladder" id="pitchLadder"></div>

        <!-- Airspeed Tape (Left) -->
        <div class="left-tape">
            <div class="tape-label">GS KTS</div>
            <div class="tape-value" id="groundSpeed">000</div>
            <div class="tape-label">M</div>
            <div class="tape-value" id="machNumber">0.00</div>
        </div>

        <!-- Altitude Tape (Right) -->
        <div class="right-tape">
            <div class="tape-label">ALT FT</div>
            <div class="tape-value" id="altitude">0000</div>
            <div class="tape-label">VSI</div>
            <div class="tape-value" id="verticalSpeed">0</div>
        </div>

        <!-- Heading Tape -->
        <div class="heading-tape">
            <div class="heading-value" id="heading">000°</div>
            <div class="heading-indicator"></div>
        </div>

        <!-- G-Force Indicator -->
        <div class="g-force-indicator">
            <div class="g-force-bar" id="gForceBar"></div>
        </div>

        <!-- Navigation Info -->
        <div class="nav-info">
            <div class="nav-item">
                <span>LAT:</span>
                <span id="latitude">---.------°</span>
            </div>
            <div class="nav-item">
                <span>LON:</span>
                <span id="longitude">---.------°</span>
            </div>
            <div class="nav-item">
                <span>ACC:</span>
                <span id="accuracy">--- m</span>
            </div>
            <div class="nav-item">
                <span>UTC:</span>
                <span id="utcTime">--:--:--</span>
            </div>
        </div>

        <!-- Warning Panel -->
        <div class="warning-panel" id="warningPanel">
            <div id="warningText">SYSTEM WARNING</div>
        </div>

        <!-- Status Panel -->
        <div class="status-panel">
            <div class="status-item">
                <span class="status-value" id="pitch">0°</span>
                <span class="status-label">PITCH</span>
            </div>
            <div class="status-item">
                <span class="status-value" id="roll">0°</span>
                <span class="status-label">ROLL</span>
            </div>
            <div class="status-item">
                <span class="status-value" id="yaw">0°</span>
                <span class="status-label">YAW</span>
            </div>
            <div class="status-item">
                <span class="status-value" id="gForce">1.0</span>
                <span class="status-label">G-FORCE</span>
            </div>
            <div class="status-item">
                <span class="status-value" id="sensorStatus">INIT</span>
                <span class="status-label">SENSORS</span>
            </div>
        </div>

        <!-- Calibration Panel -->
        <div class="calibration-panel hidden" id="calibrationPanel">
            <h3>SENSOR CALIBRATION</h3>
            <p>Hold device level and press calibrate</p>
            <button class="calibration-button" id="calibrateButton">CALIBRATE</button>
            <button class="calibration-button" id="closeCalibration">CLOSE</button>
        </div>
    </div>

    <script>
        // NATO HUD Flight Management System
        class NATOFlightHUD {
            constructor() {
                this.sensorData = {
                    orientation: { alpha: 0, beta: 0, gamma: 0 },
                    acceleration: { x: 0, y: 0, z: 0 },
                    position: { lat: null, lon: null, alt: null, accuracy: null },
                    speed: { ground: 0, vertical: 0 },
                    timestamp: Date.now()
                };
                
                this.calibration = {
                    pitch: 0,
                    roll: 0,
                    yaw: 0,
                    isCalibrated: false
                };
                
                this.previousPosition = null;
                this.speedHistory = [];
                this.initialized = false;
                
                this.initializeEventListeners();
            }

            initializeEventListeners() {
                document.getElementById('enableHUD').addEventListener('click', () => {
                    this.requestPermissions();
                });

                document.getElementById('calibrateButton').addEventListener('click', () => {
                    this.calibrateSensors();
                });

                document.getElementById('closeCalibration').addEventListener('click', () => {
                    document.getElementById('calibrationPanel').classList.add('hidden');
                });

                // Double tap to show calibration
                let tapCount = 0;
                document.addEventListener('touchstart', (e) => {
                    tapCount++;
                    if (tapCount === 1) {
                        setTimeout(() => {
                            if (tapCount === 2) {
                                document.getElementById('calibrationPanel').classList.remove('hidden');
                            }
                            tapCount = 0;
                        }, 300);
                    }
                });
            }

            async requestPermissions() {
                try {
                    // Request device orientation permission (iOS)
                    if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                        const permission = await DeviceOrientationEvent.requestPermission();
                        if (permission !== 'granted') {
                            throw new Error('Orientation permission denied');
                        }
                    }

                    // Request device motion permission (iOS)
                    if (typeof DeviceMotionEvent.requestPermission === 'function') {
                        const permission = await DeviceMotionEvent.requestPermission();
                        if (permission !== 'granted') {
                            throw new Error('Motion permission denied');
                        }
                    }

                    // Request geolocation permission
                    if ('geolocation' in navigator) {
                        navigator.geolocation.getCurrentPosition(
                            () => this.initializeHUD(),
                            (error) => {
                                console.warn('Geolocation error:', error);
                                this.initializeHUD(); // Initialize anyway
                            },
                            { enableHighAccuracy: true }
                        );
                    } else {
                        this.initializeHUD();
                    }

                } catch (error) {
                    console.error('Permission error:', error);
                    this.showWarning('SENSOR PERMISSIONS REQUIRED');
                    // Initialize anyway with limited functionality
                    this.initializeHUD();
                }
            }

            initializeHUD() {
                document.getElementById('permissionOverlay').classList.add('hidden');
                document.getElementById('hudContainer').style.display = 'flex';
                
                this.startSensorMonitoring();
                this.startGPSTracking();
                this.startUpdateLoop();
                
                this.updateSensorStatus('ACTIVE');
                this.initialized = true;
            }

            startSensorMonitoring() {
                // Device Orientation (Compass heading, pitch, roll)
                window.addEventListener('deviceorientation', (event) => {
                    this.sensorData.orientation = {
                        alpha: event.alpha || 0,    // Compass heading (0-360°)
                        beta: event.beta || 0,      // Pitch (-180 to 180°)
                        gamma: event.gamma || 0     // Roll (-90 to 90°)
                    };
                });

                // Device Motion (Acceleration, G-forces)
                window.addEventListener('devicemotion', (event) => {
                    if (event.accelerationIncludingGravity) {
                        const acc = event.accelerationIncludingGravity;
                        this.sensorData.acceleration = {
                            x: acc.x || 0,
                            y: acc.y || 0,
                            z: acc.z || 0
                        };
                    }
                });
            }

            startGPSTracking() {
                if ('geolocation' in navigator) {
                    const options = {
                        enableHighAccuracy: true,
                        timeout: 5000,
                        maximumAge: 1000
                    };

                    navigator.geolocation.watchPosition(
                        (position) => this.updatePosition(position),
                        (error) => this.handleGPSError(error),
                        options
                    );
                }
            }

            updatePosition(position) {
                const coords = position.coords;
                const currentTime = Date.now();
                
                this.sensorData.position = {
                    lat: coords.latitude,
                    lon: coords.longitude,
                    alt: coords.altitude,
                    accuracy: coords.accuracy
                };

                // Calculate ground speed using GPS
                if (this.previousPosition) {
                    const distance = this.calculateDistance(
                        this.previousPosition.lat, this.previousPosition.lon,
                        coords.latitude, coords.longitude
                    );
                    
                    const timeInterval = (currentTime - this.sensorData.timestamp) / 1000; // seconds
                    const speedMs = distance / timeInterval; // m/s
                    const speedKts = speedMs * 1.94384; // Convert to knots
                    
                    this.sensorData.speed.ground = speedKts;
                    
                    // Calculate vertical speed if altitude available
                    if (coords.altitude && this.previousPosition.alt) {
                        const altChange = coords.altitude - this.previousPosition.alt;
                        this.sensorData.speed.vertical = (altChange / timeInterval) * 3.28084; // ft/min
                    }
                }

                this.previousPosition = {
                    lat: coords.latitude,
                    lon: coords.longitude,
                    alt: coords.altitude
                };
                
                this.sensorData.timestamp = currentTime;
            }

            calculateDistance(lat1, lon1, lat2, lon2) {
                // Haversine formula for distance calculation
                const R = 6371000; // Earth's radius in meters
                const dLat = this.toRadians(lat2 - lat1);
                const dLon = this.toRadians(lon2 - lon1);
                
                const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                         Math.cos(this.toRadians(lat1)) * Math.cos(this.toRadians(lat2)) *
                         Math.sin(dLon / 2) * Math.sin(dLon / 2);
                
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                return R * c;
            }

            toRadians(degrees) {
                return degrees * (Math.PI / 180);
            }

            toDegrees(radians) {
                return radians * (180 / Math.PI);
            }

            handleGPSError(error) {
                console.error('GPS Error:', error);
                this.showWarning('GPS SIGNAL LOST');
            }

            calibrateSensors() {
                const orientation = this.sensorData.orientation;
                this.calibration = {
                    pitch: orientation.beta,
                    roll: orientation.gamma,
                    yaw: orientation.alpha,
                    isCalibrated: true
                };
                
                this.updateSensorStatus('CALIBRATED');
                document.getElementById('calibrationPanel').classList.add('hidden');
            }

            calculateCalibratedValues() {
                if (!this.calibration.isCalibrated) {
                    return {
                        pitch: this.sensorData.orientation.beta,
                        roll: this.sensorData.orientation.gamma,
                        heading: this.sensorData.orientation.alpha
                    };
                }

                let pitch = this.sensorData.orientation.beta - this.calibration.pitch;
                let roll = this.sensorData.orientation.gamma - this.calibration.roll;
                let heading = this.sensorData.orientation.alpha - this.calibration.yaw;

                // Normalize angles
                pitch = this.normalizeAngle(pitch, -180, 180);
                roll = this.normalizeAngle(roll, -90, 90);
                heading = this.normalizeAngle(heading, 0, 360);

                return { pitch, roll, heading };
            }

            normalizeAngle(angle, min, max) {
                while (angle < min) angle += (max - min);
                while (angle >= max) angle -= (max - min);
                return angle;
            }

            calculateGForce() {
                const acc = this.sensorData.acceleration;
                const magnitude = Math.sqrt(acc.x * acc.x + acc.y * acc.y + acc.z * acc.z);
                return magnitude / 9.81; // Convert to G-forces
            }

            startUpdateLoop() {
                const update = () => {
                    if (this.initialized) {
                        this.updateHUDDisplay();
                    }
                    requestAnimationFrame(update);
                };
                update();
            }

            updateHUDDisplay() {
                const calibrated = this.calculateCalibratedValues();
                const gForce = this.calculateGForce();

                // Update attitude indicator
                const horizonLine = document.getElementById('horizonLine');
                const attitudeIndicator = document.getElementById('attitudeIndicator');
                
                horizonLine.style.transform = `rotate(${calibrated.roll}deg) translateY(${calibrated.pitch * 2}px)`;
                
                // Update flight path vector
                const fpv = document.getElementById('flightPathVector');
                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;
                fpv.style.left = `${centerX + (calibrated.roll * 3)}px`;
                fpv.style.top = `${centerY - (calibrated.pitch * 3)}px`;

                // Update pitch ladder
                this.updatePitchLadder(calibrated.pitch, calibrated.roll);

                // Update displays
                document.getElementById('groundSpeed').textContent = Math.round(this.sensorData.speed.ground).toString().padStart(3, '0');
                document.getElementById('machNumber').textContent = (this.sensorData.speed.ground / 661.5).toFixed(2); // Approximate Mach calculation
                document.getElementById('altitude').textContent = Math.round(this.sensorData.position.alt || 0).toString().padStart(4, '0');
                document.getElementById('verticalSpeed').textContent = Math.round(this.sensorData.speed.vertical || 0).toString();
                document.getElementById('heading').textContent = `${Math.round(calibrated.heading).toString().padStart(3, '0')}°`;

                // Update status panel
                document.getElementById('pitch').textContent = `${calibrated.pitch.toFixed(1)}°`;
                document.getElementById('roll').textContent = `${calibrated.roll.toFixed(1)}°`;
                document.getElementById('yaw').textContent = `${calibrated.heading.toFixed(1)}°`;
                document.getElementById('gForce').textContent = gForce.toFixed(1);

                // Update G-force indicator
                const gForceBar = document.getElementById('gForceBar');
                const gForcePercent = Math.min((Math.abs(gForce) / 9) * 100, 100); // Scale to 9G max
                gForceBar.style.height = `${gForcePercent}%`;
                
                if (gForce > 7) {
                    gForceBar.style.background = 'var(--hud-red)';
                    this.showWarning('HIGH G-FORCE');
                } else if (gForce > 5) {
                    gForceBar.style.background = 'var(--hud-amber)';
                } else {
                    gForceBar.style.background = 'var(--hud-green)';
                }

                // Update navigation info
                if (this.sensorData.position.lat !== null) {
                    document.getElementById('latitude').textContent = `${this.sensorData.position.lat.toFixed(6)}°`;
                    document.getElementById('longitude').textContent = `${this.sensorData.position.lon.toFixed(6)}°`;
                    document.getElementById('accuracy').textContent = `${Math.round(this.sensorData.position.accuracy || 0)} m`;
                }

                // Update UTC time
                const now = new Date();
                document.getElementById('utcTime').textContent = now.toUTCString().slice(17, 25);
            }

            updatePitchLadder(pitch, roll) {
                const ladder = document.getElementById('pitchLadder');
                ladder.innerHTML = '';

                // Create pitch lines at 10° intervals
                for (let angle = -60; angle <= 60; angle += 10) {
                    if (Math.abs(angle - pitch) < 30) { // Only show nearby lines
                        const line = document.createElement('div');
                        line.className = 'pitch-line';
                        
                        const yOffset = (angle - pitch) * 3; // Scale factor
                        line.style.top = `${50 + yOffset}%`;
                        
                        if (angle === 0) {
                            line.innerHTML = `━━━━━━━ ${angle}° ━━━━━━━`;
                            line.style.fontWeight = 'bold';
                        } else if (angle % 20 === 0) {
                            line.innerHTML = `━━━ ${angle > 0 ? '+' : ''}${angle}° ━━━`;
                        } else {
                            line.innerHTML = `── ${angle > 0 ? '+' : ''}${angle}° ──`;
                        }
                        
                        line.style.transform = `translateX(-50%) rotate(${roll}deg)`;
                        ladder.appendChild(line);
                    }
                }
            }

            showWarning(message) {
                const warningPanel = document.getElementById('warningPanel');
                const warningText = document.getElementById('warningText');
                
                warningText.textContent = message;
                warningPanel.classList.add('active');
                
                setTimeout(() => {
                    warningPanel.classList.remove('active');
                }, 3000);
            }

            updateSensorStatus(status) {
                document.getElementById('sensorStatus').textContent = status;
                
                const statusElement = document.getElementById('sensorStatus');
                statusElement.style.color = status === 'ACTIVE' ? 'var(--hud-green)' : 
                                          status === 'CALIBRATED' ? 'var(--hud-amber)' : 
                                          'var(--hud-red)';
            }
        }

        // Initialize HUD system when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Check for HTTPS requirement
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                document.getElementById('permissionOverlay').innerHTML = `
                    <h1 style="font-size: var(--hud-font-xxl); margin-bottom: 20px; color: var(--hud-red);">HTTPS REQUIRED</h1>
                    <p style="font-size: var(--hud-font-md); margin-bottom: 30px; max-width: 400px; color: var(--hud-red);">
                        This HUD requires HTTPS to access device sensors for security reasons.
                        Please access this page via HTTPS.
                    </p>
                `;
                return;
            }

            new NATOFlightHUD();
        });

        // Prevent scrolling and zooming on mobile
        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });

        document.addEventListener('gesturestart', (e) => {
            e.preventDefault();
        });

        document.addEventListener('gesturechange', (e) => {
            e.preventDefault();
        });

        document.addEventListener('gestureend', (e) => {
            e.preventDefault();
        });
    </script>
</body>
</html>
