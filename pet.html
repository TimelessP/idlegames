<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Pet - Your Digital Companion</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #7ed321;
            --danger-color: #d0021b;
            --warning-color: #f5a623;
            --background-color: #ffffff;
            --surface-color: #f8f9fa;
            --text-color: #333333;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        @media (prefers-color-scheme: dark) {
            :root[data-theme="system"] {
                --background-color: #1a1a1a;
                --surface-color: #2d2d2d;
                --text-color: #ffffff;
                --text-secondary: #cccccc;
                --border-color: #404040;
                --shadow: 0 2px 8px rgba(0,0,0,0.3);
            }
        }

        :root[data-theme="light"] {
            --background-color: #ffffff;
            --surface-color: #f8f9fa;
            --text-color: #333333;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        :root[data-theme="dark"] {
            --background-color: #1a1a1a;
            --surface-color: #2d2d2d;
            --text-color: #ffffff;
            --text-secondary: #cccccc;
            --border-color: #404040;
            --shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            height: 100vh;
            overflow: hidden;
            transition: var(--transition);
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--surface-color);
            border-left: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background-color: var(--surface-color);
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            z-index: 10;
        }

        .pet-name {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .currency {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--secondary-color);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .pet-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            position: relative;
            background: linear-gradient(135deg, var(--surface-color) 0%, var(--background-color) 100%);
        }

        .pet-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .pet-avatar {
            width: 120px;
            height: 120px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
        }

        .pet-avatar:hover {
            transform: scale(1.05);
        }

        .pet-avatar.sleeping {
            opacity: 0.7;
        }

        .sleep-indicator {
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 1.5rem;
            animation: float 2s ease-in-out infinite;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sleep-indicator.active {
            opacity: 1;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .pet-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            width: 100%;
            max-width: 600px;
            margin-top: 2rem;
        }

        .stat-card {
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 1rem;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .stat-name {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-bar {
            width: 100%;
            height: 8px;
            background-color: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .stat-fill {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .stat-fill.hunger { background-color: var(--warning-color); }
        .stat-fill.happiness { background-color: var(--secondary-color); }
        .stat-fill.health { background-color: var(--danger-color); }
        .stat-fill.energy { background-color: var(--primary-color); }
        .stat-fill.cleanliness { background-color: #9013fe; }

        .stat-value {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .actions-panel {
            padding: 1rem;
            background-color: var(--surface-color);
            border-top: 1px solid var(--border-color);
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .action-btn {
            padding: 0.875rem 1rem;
            border: none;
            border-radius: var(--border-radius);
            background-color: var(--primary-color);
            color: white;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            min-height: 70px;
            justify-content: center;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .action-btn:active {
            transform: translateY(0);
        }

        .action-btn.feed { background-color: var(--warning-color); }
        .action-btn.play { background-color: var(--secondary-color); }
        .action-btn.sleep { background-color: #6c757d; }
        .action-btn.clean { background-color: #9013fe; }
        .action-btn.vet { background-color: var(--danger-color); }

        .modal-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem;
        }

        .modal-btn {
            padding: 0.875rem 1rem;
            border: 1px solid var(--primary-color);
            border-radius: var(--border-radius);
            background-color: transparent;
            color: var(--primary-color);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0.25rem;
        }

        .close-btn:hover {
            color: var(--text-color);
        }

        .modal-content {
            padding: 1.5rem;
        }

        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.75rem;
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .shop-item:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .item-description {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .item-price {
            font-weight: 600;
            color: var(--secondary-color);
            margin-right: 1rem;
        }

        .buy-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            background-color: var(--primary-color);
            color: white;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .buy-btn:hover {
            background-color: #357abd;
        }

        .buy-btn:disabled {
            background-color: var(--border-color);
            cursor: not-allowed;
        }

        .theme-selector {
            position: absolute;
            top: 1rem;
            right: 1rem;
            z-index: 100;
        }

        .theme-btn {
            background: none;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 0.5rem;
            cursor: pointer;
            color: var(--text-color);
            transition: var(--transition);
        }

        .theme-btn:hover {
            background-color: var(--border-color);
        }

        .notification {
            position: fixed;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow);
            z-index: 1001;
            display: none;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .notification.success {
            border-color: var(--secondary-color);
            color: var(--secondary-color);
        }

        .notification.warning {
            border-color: var(--warning-color);
            color: var(--warning-color);
        }

        .notification.error {
            border-color: var(--danger-color);
            color: var(--danger-color);
        }

        @media (max-width: 768px) {
            .app-container {
                border-left: none;
                border-right: none;
            }

            .header {
                padding: 0.75rem;
            }

            .pet-name {
                font-size: 1.25rem;
            }

            .currency {
                font-size: 1rem;
            }

            .pet-area {
                padding: 1rem;
            }

            .pet-avatar {
                width: 100px;
                height: 100px;
                font-size: 2.5rem;
            }

            .pet-status {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
                margin-top: 1.5rem;
            }

            .stat-card {
                padding: 0.75rem;
            }

            .actions-panel {
                padding: 0.75rem;
            }

            .action-buttons {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.5rem;
            }

            .modal-buttons {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }

            .action-btn, .modal-btn {
                padding: 0.75rem;
                font-size: 0.8rem;
                min-height: 60px;
            }

            .modal {
                margin: 0.5rem;
            }

            .modal-header, .modal-content {
                padding: 1rem;
            }
        }

        @media (max-width: 480px) {
            .pet-status {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                grid-template-columns: repeat(2, 1fr);
            }

            .modal-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="theme-selector">
        <button class="theme-btn" onclick="toggleTheme()">🌓</button>
    </div>

    <div class="app-container">
        <header class="header">
            <div class="pet-name" id="petName">Buddy</div>
            <div class="currency">
                <span>💰</span>
                <span id="currency">£100</span>
            </div>
        </header>

        <main class="main-content">
            <div class="pet-area">
                <div class="pet-container">
                    <div class="pet-avatar" id="petAvatar" onclick="interactWithPet()">
                        🐱
                        <div class="sleep-indicator" id="sleepIndicator">💤</div>
                    </div>
                </div>

                <div class="pet-status">
                    <div class="stat-card">
                        <div class="stat-name">Hunger</div>
                        <div class="stat-bar">
                            <div class="stat-fill hunger" id="hungerBar"></div>
                        </div>
                        <div class="stat-value" id="hungerValue">100%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-name">Happiness</div>
                        <div class="stat-bar">
                            <div class="stat-fill happiness" id="happinessBar"></div>
                        </div>
                        <div class="stat-value" id="happinessValue">100%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-name">Health</div>
                        <div class="stat-bar">
                            <div class="stat-fill health" id="healthBar"></div>
                        </div>
                        <div class="stat-value" id="healthValue">100%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-name">Energy</div>
                        <div class="stat-bar">
                            <div class="stat-fill energy" id="energyBar"></div>
                        </div>
                        <div class="stat-value" id="energyValue">100%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-name">Cleanliness</div>
                        <div class="stat-bar">
                            <div class="stat-fill cleanliness" id="cleanlinessBar"></div>
                        </div>
                        <div class="stat-value" id="cleanlinessValue">100%</div>
                    </div>
                </div>
            </div>

            <div class="actions-panel">
                <div class="action-buttons">
                    <button class="action-btn feed" onclick="feedPet()">
                        <span>🍖</span>
                        <span>Feed</span>
                    </button>
                    <button class="action-btn play" onclick="playWithPet()">
                        <span>🎾</span>
                        <span>Play</span>
                    </button>
                    <button class="action-btn sleep" onclick="putPetToSleep()">
                        <span>😴</span>
                        <span>Sleep</span>
                    </button>
                    <button class="action-btn clean" onclick="cleanPet()">
                        <span>🛁</span>
                        <span>Clean</span>
                    </button>
                </div>

                <div class="modal-buttons">
                    <button class="modal-btn" onclick="openModal('shop')">
                        <span>🛒 Shop</span>
                    </button>
                    <button class="modal-btn" onclick="openModal('vet')">
                        <span>🏥 Vet</span>
                    </button>
                    <button class="modal-btn" onclick="openModal('park')">
                        <span>🌳 Park</span>
                    </button>
                    <button class="modal-btn" onclick="openModal('achievements')">
                        <span>🏆 Achievements</span>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Shop Modal -->
    <div class="modal-overlay" id="shopModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Pet Shop</h2>
                <button class="close-btn" onclick="closeModal('shop')">&times;</button>
            </div>
            <div class="modal-content">
                <div id="shopItems"></div>
            </div>
        </div>
    </div>

    <!-- Vet Modal -->
    <div class="modal-overlay" id="vetModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Veterinary Clinic</h2>
                <button class="close-btn" onclick="closeModal('vet')">&times;</button>
            </div>
            <div class="modal-content">
                <div id="vetServices"></div>
            </div>
        </div>
    </div>

    <!-- Park Modal -->
    <div class="modal-overlay" id="parkModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Pet Park</h2>
                <button class="close-btn" onclick="closeModal('park')">&times;</button>
            </div>
            <div class="modal-content">
                <div id="parkActivities"></div>
            </div>
        </div>
    </div>

    <!-- Achievements Modal -->
    <div class="modal-overlay" id="achievementsModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Achievements</h2>
                <button class="close-btn" onclick="closeModal('achievements')">&times;</button>
            </div>
            <div class="modal-content">
                <div id="achievementsList"></div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
        // Game State
        let gameState = {
            pet: {
                name: 'Buddy',
                level: 1,
                experience: 0,
                hunger: 100,
                happiness: 100,
                health: 100,
                energy: 100,
                cleanliness: 100,
                sleeping: false,
                age: 0, // in days
                lastFed: Date.now(),
                lastPlayed: Date.now(),
                lastCleaned: Date.now(),
                lastSlept: Date.now()
            },
            player: {
                currency: 100,
                items: {},
                achievements: [],
                totalFeedings: 0,
                totalPlays: 0,
                totalCleans: 0,
                totalSleeps: 0,
                daysOwned: 0
            },
            settings: {
                theme: 'system'
            },
            lastSave: Date.now()
        };

        // Shop Items
        const shopItems = [
            { id: 'premium_food', name: 'Premium Food', description: 'Restores more hunger', price: 15, effect: { hunger: 40 } },
            { id: 'toy', name: 'Chew Toy', description: 'Increases happiness significantly', price: 25, effect: { happiness: 50 } },
            { id: 'vitamin', name: 'Health Vitamin', description: 'Boosts health and immunity', price: 30, effect: { health: 30 } },
            { id: 'energy_drink', name: 'Energy Boost', description: 'Restores energy instantly', price: 20, effect: { energy: 35 } },
            { id: 'shampoo', name: 'Premium Shampoo', description: 'Deep cleaning formula', price: 18, effect: { cleanliness: 60 } },
            { id: 'treat', name: 'Special Treat', description: 'Happiness and hunger boost', price: 12, effect: { happiness: 20, hunger: 15 } }
        ];

        // Vet Services
        const vetServices = [
            { id: 'checkup', name: 'Health Checkup', description: 'Basic health examination', price: 40, effect: { health: 25 } },
            { id: 'vaccine', name: 'Vaccination', description: 'Prevents illness and boosts immunity', price: 60, effect: { health: 40 } },
            { id: 'treatment', name: 'Medical Treatment', description: 'Comprehensive health restoration', price: 100, effect: { health: 80 } },
            { id: 'dental', name: 'Dental Cleaning', description: 'Oral health care', price: 35, effect: { health: 15, cleanliness: 30 } }
        ];

        // Park Activities
        const parkActivities = [
            { id: 'walk', name: 'Nature Walk', description: 'Peaceful walk in the park', price: 5, effect: { happiness: 15, health: 10 } },
            { id: 'run', name: 'Energetic Run', description: 'High-energy exercise', price: 8, effect: { happiness: 20, health: 15, energy: -10 } },
            { id: 'socialize', name: 'Meet Other Pets', description: 'Social interaction with other pets', price: 10, effect: { happiness: 30 } },
            { id: 'training', name: 'Agility Training', description: 'Fun training session', price: 15, effect: { happiness: 25, health: 20 } }
        ];

        // Achievements
        const achievements = [
            { id: 'first_feed', name: 'First Meal', description: 'Feed your pet for the first time', unlocked: false },
            { id: 'first_play', name: 'Playtime!', description: 'Play with your pet for the first time', unlocked: false },
            { id: 'caretaker', name: 'Good Caretaker', description: 'Feed your pet 10 times', unlocked: false, requirement: 10 },
            { id: 'playmate', name: 'Best Friend', description: 'Play with your pet 20 times', unlocked: false, requirement: 20 },
            { id: 'wealthy', name: 'Wealthy Owner', description: 'Accumulate £500', unlocked: false, requirement: 500 },
            { id: 'veteran', name: 'Veteran Owner', description: 'Own your pet for 7 days', unlocked: false, requirement: 7 },
            { id: 'perfectionist', name: 'Perfectionist', description: 'Keep all stats at 100% for 1 hour', unlocked: false }
        ];

        // Initialize game
        function initGame() {
            loadGameState();
            applyTheme();
            updateDisplay();
            startGameLoop();
            populateShop();
            populateVet();
            populatePark();
            populateAchievements();
            
            // Handle elapsed time since last save
            handleElapsedTime();
        }

        // Handle elapsed time for offline progression
        function handleElapsedTime() {
            const now = Date.now();
            const elapsedTime = now - gameState.lastSave;
            const hoursElapsed = elapsedTime / (1000 * 60 * 60);
            
            if (hoursElapsed > 0.1) { // Only process if more than 6 minutes elapsed
                // Decrease stats over time
                const hourlyDecay = {
                    hunger: 5,
                    happiness: 3,
                    energy: 4,
                    cleanliness: 2,
                    health: 1
                };

                Object.keys(hourlyDecay).forEach(stat => {
                    gameState.pet[stat] = Math.max(0, gameState.pet[stat] - (hourlyDecay[stat] * hoursElapsed));
                });

                // Calculate days elapsed
                const daysElapsed = Math.floor(hoursElapsed / 24);
                if (daysElapsed > 0) {
                    gameState.pet.age += daysElapsed;
                    gameState.player.daysOwned += daysElapsed;
                    
                    // Daily currency bonus
                    gameState.player.currency += daysElapsed * 10;
                    
                    showNotification(`Welcome back! ${daysElapsed} day(s) have passed. Your pet missed you!`, 'success');
                }

                saveGameState();
            }
        }

        // Game loop for real-time stat changes
        function startGameLoop() {
            setInterval(() => {
                updateStats();
                updateDisplay();
                checkAchievements();
                saveGameState();
            }, 30000); // Update every 30 seconds
        }

        // Update stats over time
        function updateStats() {
            if (!gameState.pet.sleeping) {
                // Gradual stat decay
                gameState.pet.hunger = Math.max(0, gameState.pet.hunger - 0.5);
                gameState.pet.happiness = Math.max(0, gameState.pet.happiness - 0.3);
                gameState.pet.energy = Math.max(0, gameState.pet.energy - 0.4);
                gameState.pet.cleanliness = Math.max(0, gameState.pet.cleanliness - 0.2);
                
                // Health decreases faster if other stats are low
                let healthDecay = 0.1;
                if (gameState.pet.hunger < 30) healthDecay += 0.2;
                if (gameState.pet.happiness < 30) healthDecay += 0.1;
                if (gameState.pet.cleanliness < 30) healthDecay += 0.1;
                
                gameState.pet.health = Math.max(0, gameState.pet.health - healthDecay);
            } else {
                // Sleeping restores energy and health slowly
                gameState.pet.energy = Math.min(100, gameState.pet.energy + 1);
                gameState.pet.health = Math.min(100, gameState.pet.health + 0.3);
                
                // Wake up when energy is full
                if (gameState.pet.energy >= 100) {
                    wakeUpPet();
                }
            }

            // Currency generation based on pet happiness
            if (gameState.pet.happiness > 50) {
                gameState.player.currency += Math.floor(gameState.pet.happiness / 50);
            }
        }

        // Pet interactions
        function feedPet() {
            if (gameState.pet.sleeping) {
                showNotification('Your pet is sleeping!', 'warning');
                return;
            }

            gameState.pet.hunger = Math.min(100, gameState.pet.hunger + 25);
            gameState.pet.happiness = Math.min(100, gameState.pet.happiness + 5);
            gameState.pet.lastFed = Date.now();
            gameState.player.totalFeedings++;
            
            addExperience(5);
            playAnimation('feed');
            showNotification('Yummy! Your pet loved the food!', 'success');
            updateDisplay();
        }

        function playWithPet() {
            if (gameState.pet.sleeping) {
                showNotification('Your pet is sleeping!', 'warning');
                return;
            }

            if (gameState.pet.energy < 20) {
                showNotification('Your pet is too tired to play!', 'warning');
                return;
            }

            gameState.pet.happiness = Math.min(100, gameState.pet.happiness + 20);
            gameState.pet.energy = Math.max(0, gameState.pet.energy - 15);
            gameState.pet.health = Math.min(100, gameState.pet.health + 5);
            gameState.pet.lastPlayed = Date.now();
            gameState.player.totalPlays++;
            
            addExperience(8);
            playAnimation('play');
            showNotification('So much fun! Your pet is happy!', 'success');
            updateDisplay();
        }

        function putPetToSleep() {
            if (gameState.pet.sleeping) {
                wakeUpPet();
                return;
            }

            if (gameState.pet.energy > 80) {
                showNotification('Your pet is not tired yet!', 'warning');
                return;
            }

            gameState.pet.sleeping = true;
            gameState.pet.lastSlept = Date.now();
            gameState.player.totalSleeps++;
            
            document.getElementById('petAvatar').classList.add('sleeping');
            document.getElementById('sleepIndicator').classList.add('active');
            
            showNotification('Sweet dreams! Your pet is sleeping peacefully.', 'success');
            updateDisplay();
        }

        function wakeUpPet() {
            gameState.pet.sleeping = false;
            document.getElementById('petAvatar').classList.remove('sleeping');
            document.getElementById('sleepIndicator').classList.remove('active');
            
            addExperience(3);
            showNotification('Good morning! Your pet is well rested.', 'success');
            updateDisplay();
        }

        function cleanPet() {
            if (gameState.pet.sleeping) {
                showNotification('Your pet is sleeping!', 'warning');
                return;
            }

            gameState.pet.cleanliness = Math.min(100, gameState.pet.cleanliness + 40);
            gameState.pet.happiness = Math.min(100, gameState.pet.happiness + 10);
            gameState.pet.health = Math.min(100, gameState.pet.health + 5);
            gameState.pet.lastCleaned = Date.now();
            gameState.player.totalCleans++;
            
            addExperience(4);
            playAnimation('clean');
            showNotification('Sparkle and shine! Your pet feels fresh and clean!', 'success');
            updateDisplay();
        }

        function interactWithPet() {
            if (gameState.pet.sleeping) {
                // Small chance to wake up pet
                if (Math.random() < 0.3) {
                    wakeUpPet();
                } else {
                    showNotification('Shh... your pet is sleeping peacefully.', 'warning');
                }
                return;
            }

            // Random positive interaction
            const interactions = [
                { text: 'Your pet purrs contentedly!', happiness: 5 },
                { text: 'Your pet nuzzles you affectionately!', happiness: 8 },
                { text: 'Your pet does a cute trick!', happiness: 6 },
                { text: 'Your pet seems happy to see you!', happiness: 4 }
            ];

            const interaction = interactions[Math.floor(Math.random() * interactions.length)];
            gameState.pet.happiness = Math.min(100, gameState.pet.happiness + interaction.happiness);
            
            playAnimation('interact');
            showNotification(interaction.text, 'success');
            updateDisplay();
        }

        // Experience and leveling
        function addExperience(amount) {
            gameState.pet.experience += amount;
            const experienceNeeded = gameState.pet.level * 100;
            
            if (gameState.pet.experience >= experienceNeeded) {
                gameState.pet.level++;
                gameState.pet.experience = 0;
                gameState.player.currency += gameState.pet.level * 10;
                
                showNotification(`Level up! Your pet is now level ${gameState.pet.level}!`, 'success');
            }
        }

        // Animations
        function playAnimation(type) {
            const petAvatar = document.getElementById('petAvatar');
            petAvatar.style.transform = 'scale(1.1)';
            
            setTimeout(() => {
                petAvatar.style.transform = 'scale(1)';
            }, 200);
        }

        // Modal management
        function openModal(modalType) {
            document.getElementById(modalType + 'Modal').classList.add('active');
        }

        function closeModal(modalType) {
            document.getElementById(modalType + 'Modal').classList.remove('active');
        }

        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.classList.remove('active');
            }
        });

        // Shop system
        function populateShop() {
            const shopItemsContainer = document.getElementById('shopItems');
            shopItemsContainer.innerHTML = shopItems.map(item => `
                <div class="shop-item">
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        <div class="item-description">${item.description}</div>
                    </div>
                    <div class="item-price">£${item.price}</div>
                    <button class="buy-btn" onclick="buyItem('${item.id}')" 
                            ${gameState.player.currency < item.price ? 'disabled' : ''}>
                        Buy
                    </button>
                </div>
            `).join('');
        }

        function buyItem(itemId) {
            const item = shopItems.find(i => i.id === itemId);
            if (!item || gameState.player.currency < item.price) {
                showNotification('Not enough currency!', 'error');
                return;
            }

            gameState.player.currency -= item.price;
            
            // Apply item effects
            Object.keys(item.effect).forEach(stat => {
                gameState.pet[stat] = Math.min(100, Math.max(0, gameState.pet[stat] + item.effect[stat]));
            });

            // Track items purchased
            gameState.player.items[itemId] = (gameState.player.items[itemId] || 0) + 1;

            showNotification(`Purchased ${item.name}!`, 'success');
            updateDisplay();
            populateShop();
        }

        // Vet system
        function populateVet() {
            const vetServicesContainer = document.getElementById('vetServices');
            vetServicesContainer.innerHTML = vetServices.map(service => `
                <div class="shop-item">
                    <div class="item-info">
                        <div class="item-name">${service.name}</div>
                        <div class="item-description">${service.description}</div>
                    </div>
                    <div class="item-price">£${service.price}</div>
                    <button class="buy-btn" onclick="buyService('${service.id}')" 
                            ${gameState.player.currency < service.price ? 'disabled' : ''}>
                        Get Service
                    </button>
                </div>
            `).join('');
        }

        function buyService(serviceId) {
            const service = vetServices.find(s => s.id === serviceId);
            if (!service || gameState.player.currency < service.price) {
                showNotification('Not enough currency!', 'error');
                return;
            }

            gameState.player.currency -= service.price;
            
            // Apply service effects
            Object.keys(service.effect).forEach(stat => {
                gameState.pet[stat] = Math.min(100, Math.max(0, gameState.pet[stat] + service.effect[stat]));
            });

            showNotification(`${service.name} completed!`, 'success');
            updateDisplay();
            populateVet();
        }

        // Park system
        function populatePark() {
            const parkActivitiesContainer = document.getElementById('parkActivities');
            parkActivitiesContainer.innerHTML = parkActivities.map(activity => `
                <div class="shop-item">
                    <div class="item-info">
                        <div class="item-name">${activity.name}</div>
                        <div class="item-description">${activity.description}</div>
                    </div>
                    <div class="item-price">£${activity.price}</div>
                    <button class="buy-btn" onclick="doActivity('${activity.id}')" 
                            ${gameState.player.currency < activity.price || gameState.pet.sleeping ? 'disabled' : ''}>
                        ${gameState.pet.sleeping ? 'Pet Sleeping' : 'Do Activity'}
                    </button>
                </div>
            `).join('');
        }

        function doActivity(activityId) {
            const activity = parkActivities.find(a => a.id === activityId);
            if (!activity || gameState.player.currency < activity.price || gameState.pet.sleeping) {
                showNotification(gameState.pet.sleeping ? 'Your pet is sleeping!' : 'Not enough currency!', 'error');
                return;
            }

            gameState.player.currency -= activity.price;
            
            // Apply activity effects
            Object.keys(activity.effect).forEach(stat => {
                gameState.pet[stat] = Math.min(100, Math.max(0, gameState.pet[stat] + activity.effect[stat]));
            });

            addExperience(10);
            showNotification(`${activity.name} was fun!`, 'success');
            updateDisplay();
            populatePark();
        }

        // Achievement system
        function populateAchievements() {
            const achievementsContainer = document.getElementById('achievementsList');
            achievementsContainer.innerHTML = achievements.map(achievement => `
                <div class="shop-item ${achievement.unlocked ? 'unlocked' : ''}">
                    <div class="item-info">
                        <div class="item-name">${achievement.unlocked ? '🏆' : '🔒'} ${achievement.name}</div>
                        <div class="item-description">${achievement.description}</div>
                    </div>
                    ${achievement.unlocked ? '<div class="item-price" style="color: var(--secondary-color);">Unlocked!</div>' : ''}
                </div>
            `).join('');
        }

        function checkAchievements() {
            achievements.forEach(achievement => {
                if (achievement.unlocked) return;

                let unlock = false;
                
                switch (achievement.id) {
                    case 'first_feed':
                        unlock = gameState.player.totalFeedings >= 1;
                        break;
                    case 'first_play':
                        unlock = gameState.player.totalPlays >= 1;
                        break;
                    case 'caretaker':
                        unlock = gameState.player.totalFeedings >= achievement.requirement;
                        break;
                    case 'playmate':
                        unlock = gameState.player.totalPlays >= achievement.requirement;
                        break;
                    case 'wealthy':
                        unlock = gameState.player.currency >= achievement.requirement;
                        break;
                    case 'veteran':
                        unlock = gameState.player.daysOwned >= achievement.requirement;
                        break;
                    case 'perfectionist':
                        unlock = Object.keys(gameState.pet).every(stat => 
                            ['hunger', 'happiness', 'health', 'energy', 'cleanliness'].includes(stat) ? 
                            gameState.pet[stat] === 100 : true
                        );
                        break;
                }

                if (unlock) {
                    achievement.unlocked = true;
                    gameState.player.achievements.push(achievement.id);
                    gameState.player.currency += 50; // Achievement reward
                    showNotification(`Achievement unlocked: ${achievement.name}! +£50`, 'success');
                    populateAchievements();
                }
            });
        }

        // Theme management
        function toggleTheme() {
            const themes = ['system', 'light', 'dark'];
            const currentIndex = themes.indexOf(gameState.settings.theme);
            const nextIndex = (currentIndex + 1) % themes.length;
            gameState.settings.theme = themes[nextIndex];
            applyTheme();
            saveGameState();
        }

        function applyTheme() {
            document.documentElement.setAttribute('data-theme', gameState.settings.theme);
        }

        // Display updates
        function updateDisplay() {
            // Update pet name and currency
            document.getElementById('petName').textContent = `${gameState.pet.name} (Level ${gameState.pet.level})`;
            document.getElementById('currency').textContent = `£${gameState.player.currency}`;

            // Update stat bars
            const stats = ['hunger', 'happiness', 'health', 'energy', 'cleanliness'];
            stats.forEach(stat => {
                const value = gameState.pet[stat];
                document.getElementById(stat + 'Bar').style.width = value + '%';
                document.getElementById(stat + 'Value').textContent = Math.round(value) + '%';
            });

            // Update sleep indicator
            const sleepIndicator = document.getElementById('sleepIndicator');
            if (gameState.pet.sleeping) {
                sleepIndicator.classList.add('active');
                document.getElementById('petAvatar').classList.add('sleeping');
            } else {
                sleepIndicator.classList.remove('active');
                document.getElementById('petAvatar').classList.remove('sleeping');
            }

            // Update modal buttons based on currency and pet state
            populateShop();
            populateVet();
            populatePark();
        }

        // Notifications
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';

            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Save/Load system
        function saveGameState() {
            gameState.lastSave = Date.now();
            localStorage.setItem('virtualPetGame', JSON.stringify(gameState));
        }

        function loadGameState() {
            const saved = localStorage.getItem('virtualPetGame');
            if (saved) {
                const loadedState = JSON.parse(saved);
                gameState = { ...gameState, ...loadedState };
                
                // Ensure new properties exist
                if (!gameState.pet.age) gameState.pet.age = 0;
                if (!gameState.player.daysOwned) gameState.player.daysOwned = 0;
                if (!gameState.player.achievements) gameState.player.achievements = [];
                if (!gameState.settings) gameState.settings = { theme: 'system' };
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            
            switch (e.key.toLowerCase()) {
                case 'f':
                    feedPet();
                    break;
                case 'p':
                    playWithPet();
                    break;
                case 's':
                    putPetToSleep();
                    break;
                case 'c':
                    cleanPet();
                    break;
                case 'escape':
                    // Close any open modal
                    document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                        modal.classList.remove('active');
                    });
                    break;
            }
        });

        // Initialize the game when the page loads
        document.addEventListener('DOMContentLoaded', initGame);

        // Auto-save periodically
        setInterval(saveGameState, 60000); // Save every minute

        // Save before page unload
        window.addEventListener('beforeunload', saveGameState);
    </script>
</body>
</html>
