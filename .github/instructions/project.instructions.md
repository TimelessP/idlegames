# IdleGames project instructions

_A quick orientation for AI agents contributing to this repo._

## Repo at a glance
- **Type:** static HTML5/CSS3/Vanilla JS Progressive Web App with many self-contained mini games/utilities, each shipped as its own `.html` file at the repo root.
- **Key runtime folders:**
  - `assets/`
    - `appicons/` – PWA icon set referenced by `manifest.webmanifest` and individual pages.
    - `audio/` – shared sound FX/music snippets.
    - `fonts/` – contains Inter + DSEG7 font assets; `assets/js/version.js` imports from here during build.
    - `js/pwa.js` – registers/upgrades the versioned service worker and handles in-app refresh prompts. `version.js` is generated by the build; never edit by hand.
  - `scripts/` – build tooling:
    - `build-sw.mjs` copies the site into `dist/`, vendors third-party libs (Three.js, QRious, jsQR, Transformers.js), copies fonts, and emits a precache list + service worker by templating `sw.template.js`.
  - `dist/` – generated build output identical to what ships to GitHub Pages/any static host. Safe to delete; recreated by the build.
- **Other important files:** `manifest.webmanifest`, `package.json` (Node 18+/20 LTS), `feedcycle.*` (largest SPA), `parental.js` (launcher parental controls), `build.sh` (helper wrapper that just runs the npm build pipeline).

## Build & serve workflow
1. Install dependencies: `npm install`
2. Build distributable: `npm run build`
   - Runs `copy-fonts`, writes `assets/js/version.js` with the `package.json` version, wipes/recreates `dist/`, copies all HTML/assets (excluding tooling directories), rewrites bare `three` imports, vendors fonts + JS dependencies, and generates `dist/sw.js` with a fresh precache list.
3. Optional clean: `npm run clean` (removes `dist/`).
4. Preview with service worker behaviour: `npm run serve` (builds, then serves `dist/` on port 4173 via `http-server`).

> **Note:** Because `version.js` is regenerated at build time, avoid committing manual edits to it. Update the version via `package.json` instead.

## Authoring guidelines
- Pages are plain HTML modules; no bundler. Keep `<script type="module">` entries self-contained or import shared helpers from `assets/js/`.
- Prefer vendoring third-party libs through the build pipeline rather than CDN URLs. If you need a new dependency, add it to `package.json` and extend `scripts/build-sw.mjs` so it’s copied into `dist/assets/vendor/`.
- Each new HTML mini-app should include the common favicon/meta block and, when it needs offline support, the `assets/js/pwa.js` loader.
- Long-lived state should use `localStorage` (existing pages follow namespaced keys like `idlegames-*`).
- When touching service-worker-adjacent code, ensure the version handshake (`idle-games-sw-version` messages) stays intact so users receive update prompts.

## Parental controls integration
- `index.html` owns the parental-control configuration (password modal copy, allowed/blocked flags, and the list of game IDs). Update the data there when adding or removing entries so the launcher exposes the correct toggles.
- Enforcement logic lives in `parental.js`. Every playable HTML page includes this script in its tail section (usually the last few lines) so hidden titles stay inaccessible even if a user opens the page directly.
- When creating a new page, copy the existing pattern: load your game scripts, then finish with `<script src="parental.js" defer></script>` (and `assets/js/pwa.js` if needed) so the parental gating and launcher stay in sync.

## Deployment/release expectations
- Bump `package.json` → rerun `npm install` to refresh `package-lock.json` → `npm run build` to recreate `dist/` and update `assets/js/version.js`.
- `dist/` contents are what gets pushed to the `gh-pages` branch (or any static host). Do not hand-edit files inside `dist/`; regenerate instead.
- The service worker cache name (`IdleGames-v<version>`) comes from the app version. Publishing without bumping the version may leave users on stale caches.

## Tips for future contributors
- The repo intentionally avoids frameworks; stick to minimal dependencies to keep load times low for slow devices.
- Many HTML files share CSS variables/utility classes; check each file’s `<style>` block before adding duplicate styles.
- Accessibility/theme toggles: follow the pattern established in pages like `feedcycle.html` (prefers `prefers-color-scheme` + persistent choice).
- For new audio, keep file sizes small and place them under `assets/audio/`; reference via relative paths so the service worker precaches them automatically.
- If you need to update icons or manifest data, ensure `manifest.webmanifest` stays in sync with actual files under `assets/appicons/`.

Use this document as a living reference—update it whenever repo conventions evolve so future agents can ramp up quickly.
