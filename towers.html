<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0b1e40">
  <meta name="application-name" content="IdleGames">
  <script src="assets/js/pwa.js" defer></script>
  <title>Towers of Hanoi - Puzzle Game</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <meta name="description" content="A clean, mobile-friendly Towers of Hanoi puzzle game with theme support.">
  <style>
    :root {
      --bg: #f5f5f5;
      --fg: #222;
      --accent: #2196f3;
      --tower: #8bc34a;
      --base: #795548;
      --font: 'Segoe UI', 'Arial', 'sans-serif';
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #181818;
        --fg: #eee;
        --accent: #64b5f6;
        --tower: #aed581;
        --base: #a1887f;
      }
    }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: var(--font);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      justify-content: center;
      touch-action: manipulation;
    }
    h1 {
      margin-top: 0.5em;
      font-weight: 600;
      letter-spacing: 0.02em;
    }
    .game-area {
      width: min(95vw, 90vh * 1.2, 600px);
      height: min(75vw, 60vh, 400px);
      background: var(--bg);
      border-radius: 16px;
      box-shadow: 0 2px 16px rgba(0,0,0,0.12);
      margin: 1em auto;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
      padding: 20px;
      border: 2px solid var(--accent);
    }
    .towers-container {
      flex: 1;
      display: flex;
      align-items: flex-end;
      justify-content: space-around;
      position: relative;
      padding: 20px 10px 60px 10px;
    }
    .base {
      position: absolute;
      bottom: 20px;
      left: 10px;
      right: 10px;
      height: 12px;
      background: var(--base);
      border-radius: 6px;
    }
    .tower {
      width: 8px;
      height: 200px;
      background: var(--tower);
      border-radius: 4px;
      position: relative;
      display: flex;
      flex-direction: column-reverse;
      align-items: center;
      cursor: pointer;
      transition: background 0.2s;
    }
    .tower:hover {
      background: var(--accent);
    }
    .tower.selected {
      background: var(--accent);
      box-shadow: 0 0 0 2px var(--accent);
    }
    .disk {
      height: 20px;
      border-radius: 10px;
      margin: 1px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.9em;
      color: #fff;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      z-index: 10;
    }
    .disk.selected {
      transform: translateY(-10px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 20;
    }
    .disk.size-1 { width: 40px; background: #f44336; }
    .disk.size-2 { width: 60px; background: #ff9800; }
    .disk.size-3 { width: 80px; background: #ffeb3b; color: #333; }
    .disk.size-4 { width: 100px; background: #4caf50; }
    .disk.size-5 { width: 120px; background: #2196f3; }
    .disk.size-6 { width: 140px; background: #9c27b0; }
    .disk.size-7 { width: 160px; background: #607d8b; }
    .controls {
      margin: 1em 0;
      display: flex;
      gap: 1em;
      justify-content: center;
      flex-wrap: wrap;
    }
    button {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 0.5em 1.2em;
      font-size: 1em;
      font-family: var(--font);
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      opacity: 0.9;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .difficulty-select {
      display: flex;
      gap: 0.5em;
      align-items: center;
    }
    .difficulty-btn {
      padding: 0.3em 0.8em;
      font-size: 0.9em;
    }
    .difficulty-btn.active {
      background: var(--tower);
      color: var(--fg);
    }
    .stats {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 1em;
      font-weight: 600;
      color: var(--accent);
      flex-wrap: wrap;
      gap: 1em;
    }
    .win-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--accent);
      color: #fff;
      padding: 2em;
      border-radius: 16px;
      text-align: center;
      font-size: 1.2em;
      font-weight: 600;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      z-index: 100;
      display: none;
    }
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 99;
      display: none;
    }
    @media (max-width: 600px) {
      .game-area {
        width: 95vw;
        height: 50vh;
        padding: 10px;
      }
      .towers-container {
        padding: 10px 5px 30px 5px;
      }
      .tower {
        height: 120px;
      }
      .disk {
        height: 14px;
        font-size: 0.7em;
      }
      .disk.size-1 { width: 25px; }
      .disk.size-2 { width: 35px; }
      .disk.size-3 { width: 45px; }
      .disk.size-4 { width: 55px; }
      .disk.size-5 { width: 65px; }
      .disk.size-6 { width: 75px; }
      .disk.size-7 { width: 85px; }
      .base {
        height: 8px;
        bottom: 10px;
      }
      .controls {
        gap: 0.5em;
      }
      .difficulty-select {
        flex-wrap: wrap;
        justify-content: center;
      }
      .stats {
        font-size: 0.9em;
        justify-content: center;
        text-align: center;
      }
    }
    
    @media (max-width: 480px) and (orientation: portrait) {
      body {
        justify-content: flex-start;
        padding-top: 1em;
      }
      h1 {
        margin: 0.5em 0;
        font-size: 1.5em;
      }
      .game-area {
        height: 45vh;
        margin: 0.5em auto;
      }
      .tower {
        height: 100px;
        width: 6px;
      }
      .disk {
        height: 12px;
        font-size: 0.6em;
      }
      .disk.size-1 { width: 20px; }
      .disk.size-2 { width: 28px; }
      .disk.size-3 { width: 36px; }
      .disk.size-4 { width: 44px; }
      .disk.size-5 { width: 52px; }
      .disk.size-6 { width: 60px; }
      .disk.size-7 { width: 68px; }
    }
  </style>
</head>
<body>
  <h1>Towers of Hanoi</h1>
  <div class="game-area">
    <div class="towers-container" id="towers-container">
      <div class="base"></div>
      <div class="tower" data-tower="0"></div>
      <div class="tower" data-tower="1"></div>
      <div class="tower" data-tower="2"></div>
    </div>
  </div>
  <div class="controls">
    <div class="difficulty-select">
      <span>Disks:</span>
      <button class="difficulty-btn" onclick="setDifficulty(3)">3</button>
      <button class="difficulty-btn" onclick="setDifficulty(4)">4</button>
      <button class="difficulty-btn active" onclick="setDifficulty(5)">5</button>
      <button class="difficulty-btn" onclick="setDifficulty(6)">6</button>
      <button class="difficulty-btn" onclick="setDifficulty(7)">7</button>
    </div>
    <button onclick="resetGame()">Reset</button>
    <button onclick="solvePuzzle()" id="solve-btn">Auto Solve</button>
    <button onclick="toggleTheme()">Theme</button>
  </div>
  <div class="stats">
    <div>Moves: <span id="moves">0</span></div>
    <div>Best: <span id="best">-</span></div>
    <div>Optimal: <span id="optimal">31</span></div>
  </div>

  <div class="overlay" id="overlay"></div>
  <div class="win-message" id="win-message">
    <div>ðŸŽ‰ Congratulations! ðŸŽ‰</div>
    <div style="margin-top: 0.5em; font-size: 0.9em;">You solved it in <span id="final-moves"></span> moves!</div>
    <button onclick="hideWinMessage()" style="margin-top: 1em;">Continue</button>
  </div>

  <script>
    let theme = localStorage.getItem('theme-towers') || 'system';
    function setTheme(mode) {
      if (mode === 'light') {
        document.documentElement.style.setProperty('--bg', '#f5f5f5');
        document.documentElement.style.setProperty('--fg', '#222');
        document.documentElement.style.setProperty('--accent', '#2196f3');
        document.documentElement.style.setProperty('--tower', '#8bc34a');
        document.documentElement.style.setProperty('--base', '#795548');
      } else if (mode === 'dark') {
        document.documentElement.style.setProperty('--bg', '#181818');
        document.documentElement.style.setProperty('--fg', '#eee');
        document.documentElement.style.setProperty('--accent', '#64b5f6');
        document.documentElement.style.setProperty('--tower', '#aed581');
        document.documentElement.style.setProperty('--base', '#a1887f');
      } else {
        document.documentElement.removeAttribute('style');
      }
      theme = mode;
      localStorage.setItem('theme-towers', mode);
    }
    function toggleTheme() {
      if (theme === 'system') setTheme('light');
      else if (theme === 'light') setTheme('dark');
      else setTheme('system');
    }
    setTheme(theme);

    // Game logic
    let towers = [[], [], []];
    let selectedDisk = null;
    let selectedTower = null;
    let moves = 0;
    let difficulty = 5;
    let isAutoSolving = false;
    let solutionSteps = [];
    let stepIndex = 0;

    function setDifficulty(disks) {
      if (isAutoSolving) return;
      difficulty = disks;
      document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      resetGame();
    }

    function resetGame() {
      if (isAutoSolving) {
        isAutoSolving = false;
        document.getElementById('solve-btn').textContent = 'Auto Solve';
      }
      towers = [[], [], []];
      selectedDisk = null;
      selectedTower = null;
      moves = 0;
      solutionSteps = [];
      stepIndex = 0;
      
      // Initialize first tower with disks
      for (let i = difficulty; i >= 1; i--) {
        towers[0].push(i);
      }
      
      updateDisplay();
      updateStats();
    }

    function updateDisplay() {
      const container = document.getElementById('towers-container');
      const towerElements = container.querySelectorAll('.tower');
      
      towerElements.forEach((towerEl, towerIndex) => {
        // Clear existing disks
        towerEl.querySelectorAll('.disk').forEach(disk => disk.remove());
        
        // Add disks for this tower
        towers[towerIndex].forEach((diskSize, diskIndex) => {
          const diskEl = document.createElement('div');
          diskEl.className = `disk size-${diskSize}`;
          diskEl.textContent = diskSize;
          diskEl.onclick = (e) => {
            e.stopPropagation();
            selectDisk(towerIndex, diskIndex);
          };
          
          if (selectedDisk && selectedDisk.tower === towerIndex && selectedDisk.disk === diskIndex) {
            diskEl.classList.add('selected');
          }
          
          towerEl.appendChild(diskEl);
        });
        
        // Tower selection
        towerEl.onclick = () => selectTower(towerIndex);
        towerEl.classList.toggle('selected', selectedTower === towerIndex);
      });
    }

    function selectDisk(towerIndex, diskIndex) {
      if (isAutoSolving) return;
      
      const tower = towers[towerIndex];
      if (diskIndex !== tower.length - 1) return; // Can only select top disk
      
      if (selectedDisk && selectedDisk.tower === towerIndex && selectedDisk.disk === diskIndex) {
        // Deselect
        selectedDisk = null;
        selectedTower = null;
      } else {
        selectedDisk = { tower: towerIndex, disk: diskIndex };
        selectedTower = null;
      }
      updateDisplay();
    }

    function selectTower(towerIndex) {
      if (isAutoSolving) return;
      
      if (selectedDisk) {
        // Try to move selected disk to this tower
        if (canMoveDisk(selectedDisk.tower, towerIndex)) {
          moveDisk(selectedDisk.tower, towerIndex);
          selectedDisk = null;
          selectedTower = null;
          moves++;
          updateDisplay();
          updateStats();
          checkWin();
        }
      } else {
        // Select tower to pick up top disk
        if (towers[towerIndex].length > 0) {
          selectedDisk = { tower: towerIndex, disk: towers[towerIndex].length - 1 };
        }
        selectedTower = towerIndex;
        updateDisplay();
      }
    }

    function canMoveDisk(fromTower, toTower) {
      const fromStack = towers[fromTower];
      const toStack = towers[toTower];
      
      if (fromStack.length === 0) return false;
      if (toStack.length === 0) return true;
      
      return fromStack[fromStack.length - 1] < toStack[toStack.length - 1];
    }

    function moveDisk(fromTower, toTower) {
      if (canMoveDisk(fromTower, toTower)) {
        const disk = towers[fromTower].pop();
        towers[toTower].push(disk);
        return true;
      }
      return false;
    }

    function updateStats() {
      document.getElementById('moves').textContent = moves;
      document.getElementById('optimal').textContent = Math.pow(2, difficulty) - 1;
      
      const bestKey = `best-towers-${difficulty}`;
      const best = localStorage.getItem(bestKey);
      if (best) {
        document.getElementById('best').textContent = best;
      } else {
        document.getElementById('best').textContent = '-';
      }
    }

    function checkWin() {
      if (towers[2].length === difficulty) {
        // Player won!
        const bestKey = `best-towers-${difficulty}`;
        const currentBest = localStorage.getItem(bestKey);
        if (!currentBest || moves < parseInt(currentBest)) {
          localStorage.setItem(bestKey, moves.toString());
        }
        
        setTimeout(() => {
          document.getElementById('final-moves').textContent = moves;
          document.getElementById('overlay').style.display = 'block';
          document.getElementById('win-message').style.display = 'block';
          updateStats();
        }, 500);
      }
    }

    function hideWinMessage() {
      document.getElementById('overlay').style.display = 'none';
      document.getElementById('win-message').style.display = 'none';
    }

    // Auto solve functionality
    function generateSolution(n, from, to, aux) {
      if (n === 1) {
        solutionSteps.push({ from, to });
        return;
      }
      generateSolution(n - 1, from, aux, to);
      solutionSteps.push({ from, to });
      generateSolution(n - 1, aux, to, from);
    }

    function solvePuzzle() {
      if (isAutoSolving) {
        // Stop auto solving
        isAutoSolving = false;
        document.getElementById('solve-btn').textContent = 'Auto Solve';
        return;
      }
      
      // Start auto solving
      isAutoSolving = true;
      document.getElementById('solve-btn').textContent = 'Stop';
      solutionSteps = [];
      stepIndex = 0;
      
      // Generate solution steps from current state
      const currentState = JSON.parse(JSON.stringify(towers)); // Deep copy
      generateSolution(difficulty, 0, 2, 1);
      
      // Reset to initial state for solving
      towers = [[], [], []];
      for (let i = difficulty; i >= 1; i--) {
        towers[0].push(i);
      }
      moves = 0;
      selectedDisk = null;
      selectedTower = null;
      updateDisplay();
      updateStats();
      
      // Start executing steps
      setTimeout(executeNextStep, 500);
    }

    function executeNextStep() {
      if (!isAutoSolving || stepIndex >= solutionSteps.length) {
        isAutoSolving = false;
        document.getElementById('solve-btn').textContent = 'Auto Solve';
        return;
      }
      
      const step = solutionSteps[stepIndex];
      
      if (moveDisk(step.from, step.to)) {
        moves++;
        updateDisplay();
        updateStats();
        stepIndex++;
        
        if (stepIndex >= solutionSteps.length) {
          // Solution complete
          setTimeout(() => {
            checkWin();
            isAutoSolving = false;
            document.getElementById('solve-btn').textContent = 'Auto Solve';
          }, 300);
        } else {
          setTimeout(executeNextStep, 600);
        }
      } else {
        // Fallback: stop autosolve if move fails
        isAutoSolving = false;
        document.getElementById('solve-btn').textContent = 'Auto Solve';
      }
    }

    // Initialize game
    resetGame();
  </script>
</body>
<script src="parental.js"></script>
</html>